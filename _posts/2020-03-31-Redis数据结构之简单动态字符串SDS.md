---
layout:     post
title:      Redis数据结构之简单动态字符串SDS
subtitle:   机会只留给那些准备充分的人
date:       2020-3-31
author:     irving.gx
header-img: img/post-bg-coffee.jpeg
catalog: true
tags:
    - Redis
---


## 初见

之前看过黄健宏老师在2014年写的一本《redis设计与实现（第二版）》，作者开篇就介绍了redis几个基本的数据结构，简单动态字符串（SDS），链表，字典，整数集合等等。当时作者在书中对于SDS的结构介绍是这样的：

 ![image](https://raw.githubusercontent.com/GuoXinsayhello/GuoXinsayhello.github.io/master/img/sds1.jpg)

从官网上下载了最新版本的源码来看，发现SDS最新的数据结构已经不是书中的样子了，现在的SDS的结构是这样的

 ![image](https://raw.githubusercontent.com/GuoXinsayhello/GuoXinsayhello.github.io/master/img/sds2.jpg)
 
了解了一下原因，发现上述的书籍在出版的时候用的是redis 3.0的版本，而目前最新的版本已经到了5.0，redis在3.2版本之后对于redis的结构设计做了较大的改动。因此就最新的redis源码做一下简单的分析。

通过上面两张图的对比可以看到，最新的redis源码对于SDS的数据结构做了较大的调整，从之前统一的一个struct结构体变成了现在的5种不同的数据结构。根据这5种数据结构的名称可以猜测是为了给不同长度的字符串采用不同的数据结构，继续看一下代码来验证我们的猜测对不对。在src/sds.c文件中有这样一个方法

 ![image](https://raw.githubusercontent.com/GuoXinsayhello/GuoXinsayhello.github.io/master/img/sds3.jpg)



#### 1.ping用的是什么协议，ttl是什么意思？

   > ICMP（Internet控制报文协议），位于网络层，和IP协议位于同一层。TTL（time to live）表示生存时间，每当一个数据包经过一个路由器的时候这个数值就会减1,起始是有一个总数的。
 
  
  
  - - -
  <p align="center">如果对你有帮助，请作者喝一杯牛奶吧</p>
     
 ![image](https://raw.githubusercontent.com/GuoXinsayhello/GuoXinsayhello.github.io/master/img/wepay.jpg)
 
 


 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
  



        
  
  
  


 
 





