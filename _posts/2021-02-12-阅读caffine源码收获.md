---
layout:     post
title:      阅读caffine源码收获
subtitle:   阅读caffine源码收获
date:       2021-02-12
author:     irving.gx
header-img: img/bg-Prague.jpeg
catalog: true
tags:
    - caffine
---


# 前言
首先说一下这个开源框架是做什么的，caffine是一个缓存框架，类似于guava cache，不过比guava性能更高，在jmh测试中同样的线程数，caffine的读写throughput都要比guava要好很多，采用了W-TinyLFU算法(高命中率、低内存占用)


# java poet

在caffine当中大量使用了JavaPoet来自动化生成java源码文件。那么JavaPoet是什么呢？这个是一个java api,可以根据注解，数据库的schema，协议格式来自动化生成java的源文件，这样可以避免生成大量重复的模板代码，样例以及详细的JavaPoet的使用方式可以参见它的github主页，https://github.com/square/javapoet


# ehcache

ehcache也是一种基于内存的缓存框架，这个框架比较轻量并且依赖比较小，并且可以持久化到硬盘当中。

# 捕获异常的方式

在看源码的时候我看到在try catch的时候有个符号很有意思，是竖线符号，将两种不同的exception隔开，如下所示：

```
catch(IOException | SQLException | Exception ex){
     logger.error(ex);
     throw new MyException(ex.getMessage());
}
```

这个在工作中的代码中没有见过这样的用法，然后就去查了一下。原来这个是java 7之后的特性，可以将上面的捕获异常与java 7之前的如下代码看做是相同的，

```
catch (IOException ex) {
     logger.error(ex);
     throw new MyException(ex.getMessage());
catch (SQLException ex) {
     logger.error(ex);
     throw new MyException(ex.getMessage());
}catch (Exception ex) {
     logger.error(ex);
     throw new MyException(ex.getMessage());
}

```
用于分隔exception的竖线符号可以认为是linux当中的管道符号。


  - - -
  <p align="center">如果对你有帮助，请作者喝一杯牛奶吧</p>
     
<img src="/img/wepay.jpg"/>

